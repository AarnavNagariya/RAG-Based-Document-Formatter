\documentclass{article}
\usepackage[utf8]{inputenc} % For input encoding
\usepackage{amsmath}        % For better math formatting
\usepackage{graphicx}

\title{Report on Command-Line Interface (CLI) Shell Implementation in C}

\author{}

\date{}

\begin{document}

\maketitle

\section{Introduction}

This C program implements a simple command-line interface (CLI) shell for Windows, similar to popular Unix/Linux shells such as Bash. The shell processes user input, manages command history, changes directories, lists files, and performs basic file system operations. The primary objective of this shell is to allow users to execute basic commands (cd, ls, pwd, echo, hist) and interact with the Windows operating system through a terminal interface.

\section{Program Structure and Components}

\subsection{Libraries and Macros}

The program includes several standard libraries:

\begin{itemize}
\item \texttt{<stdio.h>}: Standard input/output functions.
\item \texttt{<stdlib.h>}: Standard library functions like \texttt{getenv()} and \texttt{strtok()}.
\item \texttt{<string.h>}: Functions for string manipulation (\texttt{strncpy()}, \texttt{strcmp()}).
\item \texttt{<windows.h>}: Windows-specific system calls (\texttt{GetComputerName()}, \texttt{FindFirstFile()}).
\item \texttt{<direct.h>}: For directory-related functions like \texttt{\_getcwd()} and \texttt{\_chdir()}.
\item \texttt{<limits.h>}: For \texttt{PATH\_MAX} (maximum allowable path length).
\end{itemize}

Macros:

\begin{itemize}
\item \texttt{MAX\_INPUT}: Defines the maximum size for input (1024 characters).
\item \texttt{MAX\_ARGS}: Sets the maximum number of command arguments (64).
\item \texttt{MAX\_HISTORY}: Sets the size of the command history buffer (10).
\end{itemize}

\subsection{Command History Management}

The program maintains a history of the last 10 commands executed by the user.

Global Variables:

\begin{itemize}
\item \texttt{history[MAX\_HISTORY][MAX\_INPUT]}: Stores the history of the last 10 commands.
\item \texttt{history\_count}: Tracks the current number of commands in the history.
\end{itemize}

Functions:

\begin{itemize}
\item \texttt{add\_to\_history(const char *command)}: Adds the latest command to the history. If the history buffer is full, the oldest command is removed, and the new command is added.
\item \texttt{show\_history()}: Displays the command history to the user.
\end{itemize}

\subsection{Directory Navigation}

The program provides functionality to change and print the current directory.

Functions:

\begin{itemize}
\item \texttt{change\_directory(char *path, char *prev\_dir)}: Changes the current working directory. If no path is provided or the user specifies "$\sim$", it defaults to the user's home directory. If the user enters "-", the program switches to the previous directory.
\item \texttt{print\_working\_directory()}: Prints the current working directory using \texttt{\_getcwd()}.
\end{itemize}

\subsection{File Listing}

\texttt{list\_files()}: Lists the files in the current directory using Windows API functions. It leverages \texttt{FindFirstFile()} and \texttt{FindNextFile()} to traverse files and directories in the current location.

\subsection{Command Parsing and Execution}

The shell reads user input, tokenizes the command, and executes appropriate actions.

Input Parsing:

\begin{itemize}
\item The shell continuously waits for user input via \texttt{fgets()}.
\item The input is split into tokens using \texttt{strtok()}, and each token is stored in the \texttt{args} array.
\item Commands are matched using \texttt{strcmp()} and executed based on a set of predefined commands.
\end{itemize}

Supported Commands:

\begin{itemize}
\item \texttt{cd}: Changes the current directory. Handles special cases like \texttt{cd -} (switch to the previous directory) and \texttt{cd $\sim$} (switch to the home directory).
\item \texttt{ls}: Lists files in the current directory.
\item \texttt{pwd}: Prints the current working directory.
\item \texttt{echo}: Prints the provided arguments to the terminal.
\item \texttt{hist}: Displays the command history.
\item \texttt{exit}: Exits the shell program.
\end{itemize}

\subsection{Command Execution Workflow}

Prompt Display: The shell prints a prompt in the format [username@hostname cwd]\$, where:

\begin{itemize}
\item username: Retrieved from the environment variable USERNAME.
\item hostname: Obtained using the Windows function \texttt{GetComputerName()}.
\item cwd: The current working directory, fetched using \texttt{\_getcwd()}.
\end{itemize}

Input Handling:

\begin{itemize}
\item The shell reads user input and processes it with \texttt{fgets()}.
\item If the command is not empty, it is added to the history using \texttt{add\_to\_history()}.
\end{itemize}

Command Execution:

\begin{itemize}
\item The shell tokenizes the input into commands and arguments.
\item It checks for each supported command (\texttt{cd}, \texttt{ls}, \texttt{pwd}, \texttt{echo}, etc.) and invokes the corresponding function.
\item If an unsupported command is entered, the shell prints an error message.
\end{itemize}

Looping: The program continuously loops until the user types \texttt{exit}.

\section{Error Handling}

The shell performs basic error handling:

\begin{itemize}
\item If \texttt{getcwd()} or \texttt{chdir()} fails, it prints an appropriate error message.
\item If too many arguments are passed to the \texttt{cd} command, the program prints an error and ignores the command.
\item The \texttt{FindFirstFile()} function handles cases where the directory cannot be read.
\end{itemize}

\section{Key Functions}

\texttt{change\_directory(char *path, char *prev\_dir)}: Handles changing directories and supports navigating to the home directory ($\sim$) and switching to the previous directory (-).

\texttt{list\_files()}: Uses Windows API functions to list files and directories in the current location.

\texttt{echo\_command(char *input)}: This function prints the user's input to the terminal, implementing an echo command.

\section{Conclusion}

This program demonstrates how a simple command-line shell can be implemented in C on a Windows system. It includes key features like command history, directory navigation, file listing, and the ability to execute basic commands. The use of Windows API functions enables interaction with the file system, while standard C functions handle input/output and string manipulation.

The shell could be further extended by adding support for more commands and features like piping, file redirection, or job control to make it more powerful.

\end{document}
